<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snooker Career Mode</title>
<style>
body { font-family: Arial; background:#111; color:#eee; }
button { padding:10px; font-size:16px; margin:5px; }
pre { background:#000; color:#0f0; padding:10px; min-height:300px; white-space: pre-wrap; }
h3 { margin-top:20px; }
</style>
</head>
<body>

<h1>Snooker Career Mode</h1>

<div id="stats"></div>

<button id="play">Play Best-of-5 Match</button>
<button id="train">Train (Cost $ for XP)</button>
<button id="earn">Earn Cash (No XP, No Fatigue)</button>
<button id="buyFood">Buy Food (-Fatigue, $10)</button>

<h3>Allocate XP to Attributes</h3>
<div id="xpButtons"></div>

<h3>Challenge Town Rivals</h3>
<div id="rivalButtons"></div>

<h3>Town Rankings</h3>
<div id="townRankings"></div>

<pre id="output"></pre>

<script>
/* ---------- UTILS ---------- */
function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
function randomChance(p){return Math.random()*100<p;}

/* ---------- LOAD / SAVE ---------- */
function loadPlayer(){
  return JSON.parse(localStorage.getItem("player")) || {
    name:"You", age:12,
    potting:55,longPotting:40,safety:35,breakBuilding:30,
    composure:45,confidence:50,fatigue:0,experience:0,money:50,
    XP:0,attributePoints:{potting:0,longPotting:0,safety:0,breakBuilding:0,composure:0},
    trainingSessions:0
  };
}
function savePlayer(){ localStorage.setItem("player",JSON.stringify(player)); updateStats(); updateXPButtons(); }

/* ---------- PLAYER & AI ---------- */
let player = loadPlayer();

const aiRivals = [
  {name:"Local Rival", potting:50,longPotting:45,safety:60,breakBuilding:40,composure:55,confidence:50,fatigue:0,experience:10},
  {name:"Junior Champ", potting:55,longPotting:50,safety:50,breakBuilding:45,composure:50,confidence:55,fatigue:0,experience:12},
  {name:"City Prodigy", potting:48,longPotting:42,safety:55,breakBuilding:40,composure:60,confidence:45,fatigue:0,experience:8},
  {name:"Neighborhood Star", potting:52,longPotting:47,safety:53,breakBuilding:43,composure:52,confidence:50,fatigue:0,experience:9}
];

/* ---------- FATIGUE EFFECTS ---------- */
function effectiveStat(base){
  return Math.max(1, Math.floor(base * (1 - player.fatigue/150)));
}

/* ---------- FRAME SIMULATION ---------- */
function simulateFrame(a,b,pressure){
  let sa=0,sb=0;
  const log=[];
  log.push("Frame begins");

  for(let v=1;v<=12;v++){
    const p = v%2===0 ? b : a;
    const chance = clamp(
      effectiveStat(p.potting)*0.6 + effectiveStat(p.longPotting)*0.2 + effectiveStat(p.confidence)*0.2
      - pressure*0.3 - p.fatigue*0.2,
      5,95
    );

    if(randomChance(chance)){
      const pts = Math.floor(Math.random()*(effectiveStat(p.breakBuilding)/10)+10);
      log.push(`${p.name} scores ${pts}`);
      if(pts>=40) log.push("Strong break building!");
      p===a ? sa+=pts : sb+=pts;
    } else {
      log.push(`${p.name} misses`);
    }
  }

  const winner = sa>=sb ? a.name : b.name;
  log.push(`Frame score: ${a.name} ${sa}‚Äì${sb} ${b.name}`);
  log.push(`${winner} wins the frame`);
  return {winner, log};
}

/* ---------- BEST-OF-5 MATCH ---------- */
function playBestOfFiveRival(rival){
  let wp=0, wa=0, f=1;
  const out = [];
  while(wp<3 && wa<3){
    out.push(`=== FRAME ${f} vs ${rival.name} ===`);
    const fr = simulateFrame(player, rival, 30);
    fr.log.forEach(l=>out.push(l));
    fr.winner===player.name?wp++:wa++;
    out.push(`Score: ${wp}-${wa}`);
    f++;
  }
  const win = wp>wa;
  // Reward money based on rival strength
  const cashReward = 20 + Math.floor(rival.experience*1.5);
  if(win) player.money += cashReward;
  player.XP += win ? 3 : 1;
  player.fatigue += 15;
  savePlayer();
  out.push(`üèÜ Winner: ${win?player.name:rival.name}`);
  out.push(`Cash earned: $${win?cashReward:0}, XP gained: ${win?3:1}`);
  return out;
}

/* ---------- TRAINING ---------- */
function train(){
  const baseCost = 10;
  const cost = baseCost + player.trainingSessions*5;
  if(player.money < cost){ output.textContent=`Not enough money for training ($${cost})`; return; }
  const xpGain = Math.floor(Math.random()*5)+1;
  player.money -= cost;
  player.XP += xpGain;
  player.trainingSessions++;
  savePlayer();
  output.textContent=`Training complete! Cost $${cost}, gained ${xpGain} XP`;
}

/* ---------- EARN CASH ---------- */
function earnMoney(){
  const earned = Math.floor(Math.random()*15)+5;
  player.money += earned;
  savePlayer();
  output.textContent=`You earned $${earned} without fatigue!`;
}

/* ---------- BUY FOOD ---------- */
function buyFood(){
  if(player.money<10){ output.textContent="Not enough money to buy food ($10)"; return; }
  player.money -=10;
  player.fatigue -=20;
  player.fatigue = clamp(player.fatigue,0,100);
  savePlayer();
  output.textContent="Ate food! Fatigue reduced by 20.";
}

/* ---------- XP ALLOCATION ---------- */
function getAttributeCost(attr){ return (player.attributePoints[attr] || 0) + 1; }
function addAttributePoint(attr){
  const cost = getAttributeCost(attr);
  if(player.XP < cost){ output.textContent=`Not enough XP for ${attr}. Needs ${cost} XP.`; return; }
  player.XP -= cost;
  player.attributePoints[attr]++;
  player[attr] += 1;
  savePlayer();
  output.textContent=`${attr} increased by 1! Next point will cost ${getAttributeCost(attr)} XP.`;
}

/* ---------- UPDATE XP BUTTONS ---------- */
function updateXPButtons(){
  const container = document.getElementById("xpButtons");
  const attrs = ['potting','longPotting','safety','breakBuilding','composure'];
  container.innerHTML = '';
  attrs.forEach(a=>{
    const btn = document.createElement('button');
    btn.innerText = `${a.charAt(0).toUpperCase()+a.slice(1)} (+1) Cost: ${getAttributeCost(a)} XP`;
    btn.onclick = ()=>addAttributePoint(a);
    container.appendChild(btn);
  });
}

/* ---------- CHALLENGE RIVAL BUTTONS ---------- */
function updateRivalButtons(){
  const container = document.getElementById("rivalButtons");
  container.innerHTML = '';
  aiRivals.forEach((r,i)=>{
    const btn = document.createElement('button');
    btn.innerText = `Play ${r.name}`;
    btn.onclick = ()=>{ output.textContent = playBestOfFiveRival(r).join("\n"); updateTownRankings(); };
    container.appendChild(btn);
  });
}

/* ---------- TOWN RANKINGS ---------- */
function updateTownRankings(){
  const allPlayers = [player,...aiRivals];
  allPlayers.sort((a,b)=>b.experience - a.experience);
  let rankingHTML = "<b>Town Rankings:</b><br>";
  allPlayers.forEach((p,i)=>{ rankingHTML += `${i+1}. ${p.name} - XP: ${p.experience}<br>`; });
  document.getElementById("townRankings").innerHTML = rankingHTML;
}

/* ---------- STATS ---------- */
const output = document.getElementById("output");
const stats = document.getElementById("stats");
function updateStats(){
  stats.innerHTML = `<b>${player.name}</b><br>
  Potting: ${player.potting} |
  Long Potting: ${player.longPotting} |
  Safety: ${player.safety} |
  Break Building: ${player.breakBuilding} |
  Composure: ${player.composure} |
  XP: ${player.XP} |
  Money: $${player.money} |
  Fatigue: ${player.fatigue}`;
}

/* ---------- EVENT HANDLERS ---------- */
document.getElementById("play").onclick = ()=>{ output.textContent = playBestOfFiveRival(aiRivals[0]).join("\n"); updateTownRankings(); };
document.getElementById("train").onclick = train;
document.getElementById("earn").onclick = earnMoney;
document.getElementById("buyFood").onclick = buyFood;

/* ---------- INITIAL LOAD ---------- */
window.onload = function(){
  updateStats();
  updateTownRankings();
  updateXPButtons();
  updateRivalButtons();
};
</script>

</body>
</html>
